<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Caps Scenario Builder: C:/egit_repositories/CAPS-Scenario-Builder/CAPS_Scenario_Builder/src/snippets.py Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="CAPS_icon.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Caps Scenario Builder
   &#160;<span id="projectnumber">0.9</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_296f7ef44356f33aabecfab941c14354.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">snippets.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="snippets_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacesnippets.html">00001</a> <span class="stringliteral">&#39;&#39;&#39;</span>
<a name="l00002"></a>00002 <span class="stringliteral">Created on Jun 2, 2011</span>
<a name="l00003"></a>00003 <span class="stringliteral"></span>
<a name="l00004"></a>00004 <span class="stringliteral">@author: urbanec</span>
<a name="l00005"></a>00005 <span class="stringliteral">&#39;&#39;&#39;</span>
<a name="l00006"></a>00006 <span class="keyword">import</span> sys
<a name="l00007"></a>00007 <span class="keyword">from</span> PyQt4 <span class="keyword">import</span> QtCore, QtGui 
<a name="l00008"></a>00008 <span class="keyword">from</span> qgis.core <span class="keyword">import</span> *
<a name="l00009"></a>00009 <span class="keyword">from</span> qgis.gui <span class="keyword">import</span> *
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="namespacesnippets.html#a63513b3886f54e8e38577a98a5aeadd8">00011</a> self = <span class="stringliteral">&quot;some class&quot;</span>
<a name="l00012"></a><a class="code" href="namespacesnippets.html#aa91c724c7e3708ab597bb2b624cf33d9">00012</a> parent = <span class="stringliteral">&quot;some widget&#39;s parent&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014             
<a name="l00015"></a>00015             
<a name="l00016"></a>00016             <span class="comment"># add filename to statusbar</span>
<a name="l00017"></a><a class="code" href="namespacesnippets.html#aca344e60ddc2bc93d61da14293ea540a">00017</a>             capture_string = self.activeRLayer.source()
<a name="l00018"></a>00018             self.statusBar.showMessage(capture_string)
<a name="l00019"></a>00019     
<a name="l00020"></a>00020             <span class="comment"># add filename to statusbar</span>
<a name="l00021"></a>00021             capture_string = self.activeVLayer.source() <span class="comment"># a QString</span>
<a name="l00022"></a>00022             self.statusBar.showMessage(capture_string)
<a name="l00023"></a>00023 
<a name="l00024"></a>00024     
<a name="l00025"></a><a class="code" href="namespacesnippets.html#af65ccdf4ccdc8703e3b954c3123f921e">00025</a>     <span class="keyword">def </span><a class="code" href="namespacesnippets.html#af65ccdf4ccdc8703e3b954c3123f921e">moveEditLayer</a>(self, legend):
<a name="l00026"></a>00026         <span class="stringliteral">&#39;&#39;&#39; Move the needed editLayer to the top of the layer panel</span>
<a name="l00027"></a>00027 <span class="stringliteral">            and select, check and make visible.</span>
<a name="l00028"></a>00028 <span class="stringliteral">        &#39;&#39;&#39;</span>
<a name="l00029"></a>00029         items = legend.findItems(self.editLayerBaseName, QtCore.Qt.MatchFixedString, 0)
<a name="l00030"></a>00030         itemToMove = items[0]
<a name="l00031"></a>00031         
<a name="l00032"></a>00032         <span class="comment"># debugging</span>
<a name="l00033"></a>00033         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveEditLayer()&quot;</span> 
<a name="l00034"></a>00034         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveEditLayer(): length of item list is &quot;</span> + str(len(items))
<a name="l00035"></a>00035         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveEditLayer(): is this a legendLayer? &quot;</span> + str(legend.isLegendLayer(itemToMove))
<a name="l00036"></a>00036         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveEditLayer(): item to move is &quot;</span> + itemToMove.text(0)
<a name="l00037"></a>00037         
<a name="l00038"></a>00038         <span class="comment"># just moving edit layer, no need for signals</span>
<a name="l00039"></a>00039         legend.blockSignals(<span class="keyword">True</span>)
<a name="l00040"></a>00040         itemToMove.storeAppearanceSettings() <span class="comment"># Store settings </span>
<a name="l00041"></a>00041         legend.takeTopLevelItem(legend.indexOfTopLevelItem(itemToMove))
<a name="l00042"></a>00042         legend.insertTopLevelItem(0, itemToMove)
<a name="l00043"></a>00043         itemToMove.restoreAppearanceSettings()
<a name="l00044"></a>00044         legend.blockSignals(<span class="keyword">False</span>)
<a name="l00045"></a>00045         legend.setCurrentItem(itemToMove)
<a name="l00046"></a>00046         itemToMove.setCheckState(0, QtCore.Qt.Checked)
<a name="l00047"></a>00047     
<a name="l00048"></a><a class="code" href="namespacesnippets.html#a06e17560d6cbc1111180ff809185d65f">00048</a>     <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a06e17560d6cbc1111180ff809185d65f">moveBaseLayer</a>(self, legend):
<a name="l00049"></a>00049         <span class="stringliteral">&#39;&#39;&#39; Move the needed baseLayer to second the layer panel, </span>
<a name="l00050"></a>00050 <span class="stringliteral">            check and make visible.</span>
<a name="l00051"></a>00051 <span class="stringliteral">        &#39;&#39;&#39;</span>
<a name="l00052"></a>00052         items = legend.findItems(self.baseLayerBaseName, QtCore.Qt.MatchFixedString, 0)
<a name="l00053"></a>00053         itemToMove = items[0]
<a name="l00054"></a>00054         
<a name="l00055"></a>00055         <span class="comment"># debugging</span>
<a name="l00056"></a>00056         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer()&quot;</span>
<a name="l00057"></a>00057         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): length of item list is &quot;</span> + str(len(items))
<a name="l00058"></a>00058         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): is this a legendLayer? &quot;</span> + str(legend.isLegendLayer(itemToMove))
<a name="l00059"></a>00059         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): item to move is &quot;</span> + itemToMove.text(0)
<a name="l00060"></a>00060         
<a name="l00061"></a>00061         <span class="comment"># just moving base layer, no need for signals </span>
<a name="l00062"></a>00062         legend.blockSignals(<span class="keyword">True</span>)
<a name="l00063"></a>00063         itemToMove.storeAppearanceSettings() <span class="comment"># Store settings </span>
<a name="l00064"></a>00064         legend.takeTopLevelItem(legend.indexOfTopLevelItem(itemToMove))
<a name="l00065"></a>00065         legend.insertTopLevelItem(1, itemToMove)
<a name="l00066"></a>00066         itemToMove.restoreAppearanceSettings()
<a name="l00067"></a>00067         legend.blockSignals(<span class="keyword">False</span>)
<a name="l00068"></a>00068         itemToMove.setCheckState(0, QtCore.Qt.Checked)
<a name="l00069"></a>00069         
<a name="l00070"></a><a class="code" href="namespacesnippets.html#a56f7bdd51b0c19e2e9eb7376cfd0c876">00070</a>     <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a56f7bdd51b0c19e2e9eb7376cfd0c876">moveConstraintLayer</a>(self, legend):
<a name="l00071"></a>00071         <span class="stringliteral">&#39;&#39;&#39; Move the needed constraint layer to third in the layer panel, </span>
<a name="l00072"></a>00072 <span class="stringliteral">            check and make visible.</span>
<a name="l00073"></a>00073 <span class="stringliteral">        &#39;&#39;&#39;</span>
<a name="l00074"></a>00074         items = legend.findItems(self.constraintLayerBaseName, QtCore.Qt.MatchFixedString, 0)
<a name="l00075"></a>00075         itemToMove = items[0]
<a name="l00076"></a>00076         
<a name="l00077"></a>00077         <span class="comment"># debugging</span>
<a name="l00078"></a>00078         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer()&quot;</span>
<a name="l00079"></a>00079         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): length of item list is &quot;</span> + str(len(items))
<a name="l00080"></a>00080         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): is this a legendLayer? &quot;</span> + str(legend.isLegendLayer(itemToMove))
<a name="l00081"></a>00081         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Main.dlgscenarioedittypes.DlgScenarioEditTypes.moveBaseLayer(): item to move is &quot;</span> + itemToMove.text(0)
<a name="l00082"></a>00082         
<a name="l00083"></a>00083         <span class="comment"># just moving base layer, no need for signals </span>
<a name="l00084"></a>00084         legend.blockSignals(<span class="keyword">True</span>)
<a name="l00085"></a>00085         itemToMove.storeAppearanceSettings() <span class="comment"># Store settings </span>
<a name="l00086"></a>00086         legend.takeTopLevelItem(legend.indexOfTopLevelItem(itemToMove))
<a name="l00087"></a>00087         legend.insertTopLevelItem(2, itemToMove)
<a name="l00088"></a>00088         itemToMove.restoreAppearanceSettings()
<a name="l00089"></a>00089         legend.blockSignals(<span class="keyword">False</span>)
<a name="l00090"></a>00090         itemToMove.setCheckState(0, QtCore.Qt.Checked)        
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="stringliteral">&#39;&#39;&#39; OLD CODE THAT WORKED TO UPDATE EXTENTS ON MAP CANVAS </span>
<a name="l00094"></a>00094 <span class="stringliteral">    ELIMINATED WHEN I FIGURED OUT HOW TO USE mainwindow.canvas.map().render()</span>
<a name="l00095"></a>00095 <span class="stringliteral">&#39;&#39;&#39;</span>
<a name="l00096"></a><a class="code" href="namespacesnippets.html#a78e22f4e1f5171041d5b8fae1424bda2">00096</a> vfilePath = activeVLayer.source()
<a name="l00097"></a>00097 <span class="comment"># I tried every update method I could find, but nothing other than closing</span>
<a name="l00098"></a>00098 <span class="comment"># and reopening the layer seems to reset the layer extents.  So I do that here!</span>
<a name="l00099"></a><a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">00099</a> name = activeVLayer.name()
<a name="l00100"></a>00100 <span class="keywordflow">if</span> name <span class="keywordflow">in</span> config.editLayersBaseNames:
<a name="l00101"></a><a class="code" href="namespacesnippets.html#ab43b4c6b2b34be9448254e0387802cd2">00101</a>     layerId = activeVLayer.id()
<a name="l00102"></a>00102     <span class="comment"># save the color so we can keep the same color when reopening the layer</span>
<a name="l00103"></a>00103     mainwindow.layerColor = mainwindow.activeVLayer.rendererV2().symbols()[0].color()
<a name="l00104"></a>00104     <span class="comment"># remove the layer from the originalScenarioLayers list, reset the </span>
<a name="l00105"></a>00105     <span class="comment"># variables associated with the layer we are removing (to avoid runtime errors)</span>
<a name="l00106"></a>00106     <span class="comment"># and remove the layer from the registry.  Finally remove from legend and update</span>
<a name="l00107"></a>00107     <span class="comment"># the legend&#39;s layer set</span>
<a name="l00108"></a>00108     mainwindow.legend.removeEditLayerFromRegistry(activeVLayer, layerId)
<a name="l00109"></a>00109     <span class="comment"># now reopen the layer</span>
<a name="l00110"></a>00110     mainwindow.openVectorLayer(vfilePath)
<a name="l00111"></a>00111     <span class="comment"># now highlight the layer as it was before</span>
<a name="l00112"></a><a class="code" href="namespacesnippets.html#a2a8eb43303427f7271552f4522c7ba35">00112</a>     brush = QtGui.QBrush()
<a name="l00113"></a>00113     brush.setColor(QtCore.Qt.darkGreen)
<a name="l00114"></a><a class="code" href="namespacesnippets.html#a4347aa4c74e4ea21e82d7cef81556655">00114</a>     editItems = mainwindow.legend.findItems(name, QtCore.Qt.MatchFixedString, 0)
<a name="l00115"></a>00115     editItems[0].setForeground(0, brush)
<a name="l00116"></a>00116     <span class="comment"># Make the layer visible.  This will cause a signal to be sent</span>
<a name="l00117"></a>00117     <span class="comment"># and the legend will update the layer&#39;s status if not visible.</span>
<a name="l00118"></a>00118     <span class="comment"># because we have just opened it, it is the active layer</span>
<a name="l00119"></a>00119     mainwindow.legend.currentItem().setCheckState(0, QtCore.Qt.Checked)
<a name="l00120"></a>00120     
<a name="l00121"></a>00121     <span class="keywordflow">return</span> <span class="comment"># opening the layer will update the extents, so just return&#39;&#39;&#39;</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="stringliteral">&#39;&#39;&#39;CODE FOR OLD SYMBOLOGY THAT WORKED&#39;&#39;&#39;</span>
<a name="l00125"></a>00125 self.activeVLayer.setUsingRendererV2(<span class="keyword">False</span>)
<a name="l00126"></a><a class="code" href="namespacesnippets.html#a8d884ac7f1ee4c3a8cdb2263a846e586">00126</a>                 renderer = QgsSingleSymbolRenderer(QGis.Polygon)
<a name="l00127"></a><a class="code" href="namespacesnippets.html#a9604257c36f487ca5238b217556fe155">00127</a>                 symbol = renderer.symbols()[0]
<a name="l00128"></a>00128                 symbol.setFillStyle(QtCore.Qt.NoBrush)
<a name="l00129"></a>00129                 symbol.setLineWidth(0.3)
<a name="l00130"></a>00130                 self.activeVLayer.setRenderer(renderer)
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="stringliteral">&#39;&#39;&#39;# These are lists of dictionaries that contain the values for the various &quot;comboBoxOptions&quot; displayed</span>
<a name="l00133"></a>00133 <span class="stringliteral"># in the combo box widgets dropdown lists for each scenario type. They were used to &quot;lookup&quot; the </span>
<a name="l00134"></a>00134 <span class="stringliteral"># &quot;score&quot; corresponding to the users input so that it could be inserted into the Export Scenario csv file.</span>
<a name="l00135"></a>00135 <span class="stringliteral"># Although they duplicate much of the information in the field values lists above, they were separate</span>
<a name="l00136"></a>00136 <span class="stringliteral"># because the lists above are ordered (and can be predictably looped through), </span>
<a name="l00137"></a>00137 <span class="stringliteral"># while dictionaries are unordered. Now that we added the &quot;scores&quot; to the comboBoxOptions, </span>
<a name="l00138"></a>00138 <span class="stringliteral"># I changed code to &#39;slice&#39; the &#39;scores&#39; from the </span>
<a name="l00139"></a>00139 <span class="stringliteral"># comboBoxOptions strings above, making the lists below unnecessary.</span>
<a name="l00140"></a>00140 <span class="stringliteral">valuesDictionaryList0 = [{&#39;&#39;: &#39;empty&#39;, &#39;1.0 - Full passage&#39;: &#39;1.0&#39;, &#39;0.8 - Minor barrier&#39;: &#39;0.8&#39;, </span>
<a name="l00141"></a>00141 <span class="stringliteral">                          &#39;0.6 - Moderate barrier&#39;: &#39;0.6&#39;,</span>
<a name="l00142"></a>00142 <span class="stringliteral">                           &#39;0.4 - Significant barrier&#39;: &#39;0.4&#39;, &#39;0.2 - Severe barrier&#39;: &#39;0.2&#39;}]</span>
<a name="l00143"></a>00143 <span class="stringliteral">valuesDictionaryList1 = [{&#39;&#39;: &#39;empty&#39;, &#39;1.0 - Complete removal/full passage&#39;: &#39;1.0&#39;, </span>
<a name="l00144"></a>00144 <span class="stringliteral">                          &#39;0.6 - Fishway/breached dam&#39;: &#39;0.6&#39;, &#39;0.2 - Eel passage only&#39;: &#39;0.2&#39;,</span>
<a name="l00145"></a>00145 <span class="stringliteral">                         &#39;0.0 - Full barrier&#39;: &#39;0.0&#39;}]</span>
<a name="l00146"></a>00146 <span class="stringliteral">valuesDictionaryList2 = [{&#39;&#39;: &#39;empty&#39;, &#39;1.0 - Full passage (bear, moose)&#39;: &#39;1.0&#39;, </span>
<a name="l00147"></a>00147 <span class="stringliteral">                          &#39;0.75 - Large animals (fox, coyote, fisher, bobcat, otter)&#39;: &#39;0.75&#39;, </span>
<a name="l00148"></a>00148 <span class="stringliteral">                          &#39;0.5 - Medium animals (rabbit, skunk, mink, opossum, raccoon)&#39;: &#39;0.5&#39;, </span>
<a name="l00149"></a>00149 <span class="stringliteral">                          &#39;0.2 - Small animals (amphibians, reptiles, mice, voles, chipmunk, weasel)&#39;: </span>
<a name="l00150"></a>00150 <span class="stringliteral">                          &#39;0.2&#39;, &#39;0.0 - No passage structure&#39;: &#39;0.0&#39;}]</span>
<a name="l00151"></a>00151 <span class="stringliteral">valuesDictionaryList3 = [{&#39;&#39;: &#39;empty&#39;, &#39;0 m - No restriction&#39;: &#39;0 m&#39;, </span>
<a name="l00152"></a>00152 <span class="stringliteral">                          &#39;0.5 m - Minor restriction&#39;: &#39;0.5 m&#39;, &#39;1.0 m - Moderate restriction&#39;: &#39;1.0 m&#39;,</span>
<a name="l00153"></a>00153 <span class="stringliteral">                           &#39;2.0 m - Severe restriction&#39;: &#39;2.0 m&#39;}]</span>
<a name="l00154"></a>00154 <span class="stringliteral">valuesDictionaryList4 = [{u&#39;&#39;: &#39;empty&#39;, u&#39;0.0 - none(closed road; 0 cars/day)&#39;: &#39;0.0&#39;, </span>
<a name="l00155"></a>00155 <span class="stringliteral">                          u&#39;0.025 - very low(tiny road; 100 cars/day)&#39;: &#39;0.025&#39;, </span>
<a name="l00156"></a>00156 <span class="stringliteral">                          u&#39;0.2 - low(minor road; 800 cars/day)&#39;: &#39;0.2&#39;,</span>
<a name="l00157"></a>00157 <span class="stringliteral">                           u&#39;0.5 - medium(collector; 2500 cars/day)&#39;: &#39;0.5&#39;, </span>
<a name="l00158"></a>00158 <span class="stringliteral">                          u&#39;0.75 - medium-high(secondary highway; 5000 cars/day)&#39;: &#39;0.75&#39;,     </span>
<a name="l00159"></a>00159 <span class="stringliteral">                          u&#39;0.94 - high(primary highway; 10,000 cars/day)&#39;: &#39;0.94&#39;,</span>
<a name="l00160"></a>00160 <span class="stringliteral">                            u&#39;1.0 - extreme(expressway; &gt;40,000 cars/day)&#39;: &#39;1.0&#39;}, {&#39;add road class&#39;: &#39;some value&#39;}]</span>
<a name="l00161"></a>00161 <span class="stringliteral">valuesDictionaryList5 = [{u&#39;&#39;: &#39;empty&#39;, u&#39;0.0 - none(closed road; 0 cars/day)&#39;: &#39;0.0&#39;, </span>
<a name="l00162"></a>00162 <span class="stringliteral">                          u&#39;0.025 - very low(tiny road; 100 cars/day)&#39;: &#39;0.025&#39;, </span>
<a name="l00163"></a>00163 <span class="stringliteral">                          u&#39;0.2 - low(minor road; 800 cars/day)&#39;: &#39;0.2&#39;,</span>
<a name="l00164"></a>00164 <span class="stringliteral">                           u&#39;0.5 - medium(collector; 2500 cars/day)&#39;: &#39;0.5&#39;, </span>
<a name="l00165"></a>00165 <span class="stringliteral">                          u&#39;0.75 - medium-high(secondary highway; 5000 cars/day)&#39;: &#39;0.75&#39;,     </span>
<a name="l00166"></a>00166 <span class="stringliteral">                          u&#39;0.94 - high(primary highway; 10,000 cars/day)&#39;: &#39;0.94&#39;,</span>
<a name="l00167"></a>00167 <span class="stringliteral">                            u&#39;1.0 - extreme(expressway; &gt;40,000 cars/day)&#39;: &#39;1.0&#39;}, {&#39;add road class?&#39;: &#39;some value&#39;}]</span>
<a name="l00168"></a>00168 <span class="stringliteral">valuesDictionaryList6 = [{&#39;&#39;: &#39;empty&#39;, &#39;1 - Commercial&#39;: &#39;1&#39;, &#39;2 - Industrial&#39;: &#39;2&#39;, </span>
<a name="l00169"></a>00169 <span class="stringliteral">                          &#39;10 - Residential&#39;: &#39;10&#39;, &#39;30 - Cropland&#39;: &#39;30&#39;, &#39;50 - Water&#39;: &#39;50&#39;}]&#39;&#39;&#39;</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">#    THE BELOW CRASHES THE APP</span>
<a name="l00173"></a>00173 <span class="comment">#self.info = QtCore.QFileInfo(QtCore.QString(self.mainwindow.scenarioFilePath))</span>
<a name="l00174"></a>00174 <span class="comment">#self.mainwindow.legend.removeAll()</span>
<a name="l00175"></a>00175 <span class="comment"># remove all layers from the registry</span>
<a name="l00176"></a>00176 <span class="comment">#QgsMapLayerRegistry.instance().removeAllMapLayers()</span>
<a name="l00177"></a>00177 <span class="comment">#scenario = QgsProject.instance()</span>
<a name="l00178"></a>00178 <span class="comment">#scenario.write(self.info)</span>
<a name="l00179"></a>00179 <span class="comment">#scenario.read(self.info)</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment"># Try closing and reloading the scenario after adding features in order</span>
<a name="l00182"></a>00182 <span class="comment"># to update extents</span>
<a name="l00183"></a>00183 <span class="comment">#self.mainwindow</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="comment"># the below crashed the app when trying to update extentnts.</span>
<a name="l00187"></a>00187 <span class="comment"># Try closing and reloading the layer after adding features in order</span>
<a name="l00188"></a>00188         <span class="comment"># to update extents</span>
<a name="l00189"></a>00189         vfilePath = self.activeVLayer.source()
<a name="l00190"></a><a class="code" href="namespacesnippets.html#a08d3518495f631dc3c94eedd23815e35">00190</a>         vfileID = self.activeVLayer.getLayerID()
<a name="l00191"></a>00191         <span class="keywordflow">print</span> <span class="stringliteral">&quot;vfileID is &quot;</span> + str(vfileID)
<a name="l00192"></a>00192         self.mainwindow.activeVLayer = <span class="keywordtype">None</span>
<a name="l00193"></a>00193         QgsMapLayerRegistry.instance().removeMapLayer(vfileID)
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="comment"># the below doesn&#39;t work</span>
<a name="l00197"></a>00197 <span class="comment"># make the files in the ./data/baselayer directory read only</span>
<a name="l00198"></a>00198 <span class="stringliteral">&#39;&#39;&#39;directoryFileList = os.listdir(self.baseLayersPath)</span>
<a name="l00199"></a>00199 <span class="stringliteral">for file in directoryFileList:</span>
<a name="l00200"></a>00200 <span class="stringliteral">    path = self.baseLayersPath + file</span>
<a name="l00201"></a>00201 <span class="stringliteral">    print &quot;current file is: &quot; + file</span>
<a name="l00202"></a>00202 <span class="stringliteral">    print &quot;current path is: &quot; + path</span>
<a name="l00203"></a>00203 <span class="stringliteral">    os.chmod(path, stat.S_IWRITE)&#39;&#39;&#39;</span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="stringliteral">&#39;&#39;&#39; Field names corresponding to user input fields only </span>
<a name="l00207"></a>00207 <span class="stringliteral"># If you add a new label above, you must add the new field name here.</span>
<a name="l00208"></a>00208 <span class="stringliteral"># You must also add the new field name to the corresponding </span>
<a name="l00209"></a>00209 <span class="stringliteral">#self.fieldValues list below </span>
<a name="l00210"></a>00210 <span class="stringliteral">self.userInputFieldNames0 = self.fieldNames0 = [&#39;aqua_score&#39;, &#39;terr_score&#39;] </span>
<a name="l00211"></a>00211 <span class="stringliteral">self.userInputFieldNames1 =self.fieldNames1 = [&#39;aqua_score&#39;]</span>
<a name="l00212"></a>00212 <span class="stringliteral">self.userInputFieldNames2 =self.fieldNames2 = [&#39;terr_score&#39;]</span>
<a name="l00213"></a>00213 <span class="stringliteral">self.userInputFieldNames3 =self.fieldNames3 = [&#39;r_severity&#39;]</span>
<a name="l00214"></a>00214 <span class="stringliteral">self.userInputFieldNames4 =self.fieldNames4 = [&#39;newrd_rate&#39;, &#39;newrd_clas&#39;]</span>
<a name="l00215"></a>00215 <span class="stringliteral">self.userInputFieldNames5 =self.fieldNames5 = [&#39;modrd_rate&#39;, &#39;modrd_cls&#39;]</span>
<a name="l00216"></a>00216 <span class="stringliteral">self.userInputFieldNames6 =self.fieldNames6 = [&#39;ldcvr_cls&#39;]&#39;&#39;&#39;</span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="comment"># change directory permissions</span>
<a name="l00219"></a>00219     <span class="keyword">import</span> os
<a name="l00220"></a>00220     <span class="keyword">import</span> stat
<a name="l00221"></a>00221      
<a name="l00222"></a>00222     <span class="keywordflow">try</span>:
<a name="l00223"></a>00223     <span class="comment"># create a folder with mode 777 (octal)</span>
<a name="l00224"></a>00224     os.mkdir(<span class="stringliteral">&quot;montypython&quot;</span>)
<a name="l00225"></a>00225     <span class="comment"># change mode to 577</span>
<a name="l00226"></a>00226     os.chmod(<span class="stringliteral">&quot;montypython&quot;</span>, 0577) <span class="comment"># don&#39;t forget the 0</span>
<a name="l00227"></a>00227     <span class="comment"># get the current mode and print it</span>
<a name="l00228"></a>00228     <span class="keywordflow">print</span> stat.S_IMODE(os.stat(<span class="stringliteral">&quot;montypython&quot;</span>)[stat.ST_MODE])
<a name="l00229"></a>00229     <span class="keywordflow">finally</span>:
<a name="l00230"></a>00230     <span class="comment"># in any case, attempt to remove directory</span>
<a name="l00231"></a>00231     <span class="keywordflow">try</span>:
<a name="l00232"></a>00232     os.rmdir(<span class="stringliteral">&quot;montypython&quot;</span>)
<a name="l00233"></a>00233     <span class="keywordflow">except</span> OSError:
<a name="l00234"></a>00234     <span class="keywordflow">pass</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="comment"># code to chang file permissions on windows</span>
<a name="l00238"></a>00238 <span class="keyword">from</span> win32api <span class="keyword">import</span> MoveFileEx, GetUserName
<a name="l00239"></a>00239  
<a name="l00240"></a>00240 <span class="keyword">from</span> win32file <span class="keyword">import</span> (
<a name="l00241"></a>00241     MOVEFILE_COPY_ALLOWED,
<a name="l00242"></a>00242     MOVEFILE_REPLACE_EXISTING,
<a name="l00243"></a>00243     MOVEFILE_WRITE_THROUGH
<a name="l00244"></a>00244 )
<a name="l00245"></a>00245 <span class="keyword">from</span> win32security <span class="keyword">import</span> (
<a name="l00246"></a>00246     LookupAccountName,
<a name="l00247"></a>00247     GetFileSecurity,
<a name="l00248"></a>00248     SetFileSecurity,
<a name="l00249"></a>00249     ACL,
<a name="l00250"></a>00250     DACL_SECURITY_INFORMATION,
<a name="l00251"></a>00251     ACL_REVISION
<a name="l00252"></a>00252 )
<a name="l00253"></a>00253 <span class="keyword">from</span> ntsecuritycon <span class="keyword">import</span> (
<a name="l00254"></a>00254     FILE_ALL_ACCESS,
<a name="l00255"></a>00255     FILE_GENERIC_EXECUTE,
<a name="l00256"></a>00256     FILE_GENERIC_READ,
<a name="l00257"></a>00257     FILE_GENERIC_WRITE,
<a name="l00258"></a>00258     FILE_LIST_DIRECTORY
<a name="l00259"></a>00259 )
<a name="l00260"></a>00260  
<a name="l00261"></a><a class="code" href="namespacesnippets.html#ac1510a98c51cdf57e510ff6a51c23c61">00261</a> EVERYONE_GROUP = <span class="stringliteral">&#39;Everyone&#39;</span>
<a name="l00262"></a><a class="code" href="namespacesnippets.html#ab9b425b32c9889d22b0080b95e3d15f9">00262</a> ADMINISTRATORS_GROUP = <span class="stringliteral">&#39;Administrators&#39;</span>
<a name="l00263"></a>00263  
<a name="l00264"></a><a class="code" href="namespacesnippets.html#a0601a4bcb6128720f3dbf739b1a8b470">00264</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a0601a4bcb6128720f3dbf739b1a8b470">_get_group_sid</a>(group_name):
<a name="l00265"></a>00265     <span class="stringliteral">&quot;&quot;&quot;Return the SID for a group with the given name.&quot;&quot;&quot;</span>
<a name="l00266"></a>00266     <span class="keywordflow">return</span> LookupAccountName(<span class="stringliteral">&#39;&#39;</span>, group_name)[0]
<a name="l00267"></a>00267  
<a name="l00268"></a>00268  
<a name="l00269"></a><a class="code" href="namespacesnippets.html#a985ec52ae35229f1b6fe2896251be865">00269</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a985ec52ae35229f1b6fe2896251be865">_set_file_attributes</a>(path, groups):
<a name="l00270"></a>00270     <span class="stringliteral">&quot;&quot;&quot;Set file attributes using the wind32api.&quot;&quot;&quot;</span>
<a name="l00271"></a>00271     security_descriptor = GetFileSecurity(path, DACL_SECURITY_INFORMATION)
<a name="l00272"></a>00272     dacl = ACL()
<a name="l00273"></a>00273     <span class="keywordflow">for</span> group_name <span class="keywordflow">in</span> groups:
<a name="l00274"></a>00274         <span class="comment"># set the attributes of the group only if not null</span>
<a name="l00275"></a>00275         <span class="keywordflow">if</span> groups[group_name]:
<a name="l00276"></a>00276             group_sid = <a class="code" href="namespacesnippets.html#a0601a4bcb6128720f3dbf739b1a8b470">_get_group_sid</a>(group_name)
<a name="l00277"></a>00277             dacl.AddAccessAllowedAce(ACL_REVISION, groups[group_name],
<a name="l00278"></a>00278                 group_sid)
<a name="l00279"></a>00279     <span class="comment"># the dacl has all the info of the dff groups passed in the parameters</span>
<a name="l00280"></a>00280     security_descriptor.SetSecurityDescriptorDacl(1, dacl, 0)
<a name="l00281"></a>00281     SetFileSecurity(path, DACL_SECURITY_INFORMATION, security_descriptor)
<a name="l00282"></a>00282  
<a name="l00283"></a><a class="code" href="namespacesnippets.html#a3daca2abc299e8fa9ded180c1988496d">00283</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a3daca2abc299e8fa9ded180c1988496d">set_file_readonly</a>(path):
<a name="l00284"></a>00284     <span class="stringliteral">&quot;&quot;&quot;Change path permissions to readonly in a file.&quot;&quot;&quot;</span>
<a name="l00285"></a>00285     <span class="comment"># we use the win32 api because chmod just sets the readonly flag and</span>
<a name="l00286"></a>00286     <span class="comment"># we want to have imore control over the permissions</span>
<a name="l00287"></a>00287     groups = {}
<a name="l00288"></a>00288     groups[EVERYONE_GROUP] = FILE_GENERIC_READ
<a name="l00289"></a>00289     groups[ADMINISTRATORS_GROUP] = FILE_GENERIC_READ
<a name="l00290"></a>00290     groups[GetUserName()] = FILE_GENERIC_READ
<a name="l00291"></a>00291     <span class="comment"># the above equals more or less to 0444</span>
<a name="l00292"></a>00292     <a class="code" href="namespacesnippets.html#a985ec52ae35229f1b6fe2896251be865">_set_file_attributes</a>(path, groups)
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="stringliteral">&#39;&#39;&#39;Martin Dobias raster transparency</span>
<a name="l00295"></a>00295 <span class="stringliteral">This way you can access current list of transparency values:</span>
<a name="l00296"></a>00296 <span class="stringliteral"></span>
<a name="l00297"></a>00297 <span class="stringliteral">&gt;&gt;&gt; rt=l.rasterTransparency()</span>
<a name="l00298"></a>00298 <span class="stringliteral"></span>
<a name="l00299"></a>00299 <span class="stringliteral">&gt;&gt;&gt; lst = rt.transparentSingleValuePixelList()</span>
<a name="l00300"></a>00300 <span class="stringliteral"></span>
<a name="l00301"></a>00301 <span class="stringliteral">&gt;&gt;&gt; for item in lst: print item.pixelValue, item.percentTransparent</span>
<a name="l00302"></a>00302 <span class="stringliteral"></span>
<a name="l00303"></a>00303 <span class="stringliteral">...</span>
<a name="l00304"></a>00304 <span class="stringliteral"></span>
<a name="l00305"></a>00305 <span class="stringliteral">-9999.0 100.0</span>
<a name="l00306"></a>00306 <span class="stringliteral"></span>
<a name="l00307"></a>00307 <span class="stringliteral">0.0 50.0</span>
<a name="l00308"></a>00308 <span class="stringliteral"></span>
<a name="l00309"></a>00309 <span class="stringliteral">To set a list with just one value:</span>
<a name="l00310"></a>00310 <span class="stringliteral"></span>
<a name="l00311"></a>00311 <span class="stringliteral">&gt;&gt;&gt; x = QgsRasterTransparency.TransparentSingleValuePixel()</span>
<a name="l00312"></a>00312 <span class="stringliteral"></span>
<a name="l00313"></a>00313 <span class="stringliteral">&gt;&gt;&gt; x.pixelValue = 123</span>
<a name="l00314"></a>00314 <span class="stringliteral"></span>
<a name="l00315"></a>00315 <span class="stringliteral">&gt;&gt;&gt; x.transparencyPercent = 50</span>
<a name="l00316"></a>00316 <span class="stringliteral"></span>
<a name="l00317"></a>00317 <span class="stringliteral">&gt;&gt;&gt; rt.setTransparentSingleValuePixelList( [ x ] )</span>
<a name="l00318"></a>00318 <span class="stringliteral"></span>
<a name="l00319"></a>00319 <span class="stringliteral"></span>
<a name="l00320"></a>00320 <span class="stringliteral">The above examples suppose that you use single band raster. In case of RGB</span>
<a name="l00321"></a>00321 <span class="stringliteral">image the steps are similar, just instead of &quot;SingleValue&quot; methods you would</span>
<a name="l00322"></a>00322 <span class="stringliteral">use &quot;ThreeValue&quot; methods and instead of &quot;pixelValue&quot; attribute there are</span>
<a name="l00323"></a>00323 <span class="stringliteral">&quot;red&quot;, &quot;green&quot;, &quot;blue&quot; attributes.&#39;&#39;&#39;</span>
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment"># obsolete code.  Use legend.findItems().  much easier</span>
<a name="l00326"></a><a class="code" href="namespacesnippets.html#af70e8824e0faa96c888895cded1f8781">00326</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#af70e8824e0faa96c888895cded1f8781">oldarrangeOrientingLayers</a>(self):
<a name="l00327"></a>00327         <span class="comment"># debugging</span>
<a name="l00328"></a>00328         <span class="keywordflow">print</span> <span class="stringliteral">&quot;arrangeOrientingLayers()&quot;</span>
<a name="l00329"></a>00329         
<a name="l00330"></a>00330         legend = self.legend
<a name="l00331"></a>00331         legendLayers = legend.getLayerSet()
<a name="l00332"></a>00332         numLegendLayers = len(legendLayers)
<a name="l00333"></a>00333         oRLayers = self.orientingRasterLayers
<a name="l00334"></a>00334         oVLayers = self.orientingVectorLayers
<a name="l00335"></a>00335         rcount = 0
<a name="l00336"></a>00336         vcount = 0
<a name="l00337"></a>00337         
<a name="l00338"></a>00338         <span class="keywordflow">print</span> <span class="stringliteral">&quot;numLegendLayers is &quot;</span> + str(numLegendLayers)
<a name="l00339"></a>00339         
<a name="l00340"></a>00340         <span class="keywordflow">for</span> (counter, legendLayer) <span class="keywordflow">in</span> enumerate(legendLayers):
<a name="l00341"></a>00341             legendLayerName = legendLayer.layer().<a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">name</a>()
<a name="l00342"></a>00342             <span class="keywordflow">print</span> <span class="stringliteral">&quot;legendLayerName is &quot;</span> + legendLayerName
<a name="l00343"></a>00343             <span class="keywordflow">print</span> <span class="stringliteral">&quot;r counter is &quot;</span> + str(counter)
<a name="l00344"></a>00344             <span class="keywordflow">for</span> orientingLayer <span class="keywordflow">in</span> oRLayers:
<a name="l00345"></a>00345                 info = QtCore.QFileInfo(orientingLayer)
<a name="l00346"></a>00346                 orientingLayerName = info.completeBaseName()
<a name="l00347"></a>00347                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;orientingLayerName is &quot;</span> + orientingLayerName
<a name="l00348"></a>00348                 <span class="keywordflow">if</span> legendLayerName == orientingLayerName:
<a name="l00349"></a>00349                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;orientingLayerName inside is &quot;</span> + orientingLayerName
<a name="l00350"></a>00350                     itemToMove = legend.topLevelItem(counter)
<a name="l00351"></a>00351                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;itemToMove is &quot;</span> + itemToMove.canvasLayer.layer().<a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">name</a>()
<a name="l00352"></a>00352                     position = numLegendLayers - oRLayers.index(orientingLayer) <span class="comment"># itemToMove is the base layer</span>
<a name="l00353"></a>00353                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;r position is &quot;</span> + str(position)
<a name="l00354"></a>00354                     <span class="keywordflow">print</span> type(position), position
<a name="l00355"></a>00355                     itemToMove.storeAppearanceSettings() <span class="comment"># Store settings </span>
<a name="l00356"></a>00356                     self.legend.takeTopLevelItem(counter)
<a name="l00357"></a>00357                     legend.insertTopLevelItem(1, itemToMove)
<a name="l00358"></a>00358                     rcount += 1
<a name="l00359"></a>00359                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;ending rcount is &quot;</span> + str(rcount)
<a name="l00360"></a>00360                     <span class="keywordflow">if</span> rcount == len(oRLayers):
<a name="l00361"></a>00361                         <span class="keywordflow">break</span>
<a name="l00362"></a>00362                     <span class="keywordflow">else</span>: <span class="keywordflow">continue</span>
<a name="l00363"></a>00363             
<a name="l00364"></a>00364         <span class="comment"># debugging</span>
<a name="l00365"></a>00365         <span class="keywordflow">print</span> <span class="stringliteral">&quot;rcount is &quot;</span> + str(rcount)
<a name="l00366"></a>00366        
<a name="l00367"></a>00367         <span class="keywordflow">for</span> (counter, legendLayer) <span class="keywordflow">in</span> enumerate(legendLayers):
<a name="l00368"></a>00368             legendLayerName = legendLayer.layer().<a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">name</a>()
<a name="l00369"></a>00369             <span class="keywordflow">print</span> <span class="stringliteral">&quot;legendLayerName is &quot;</span> + legendLayerName
<a name="l00370"></a>00370             <span class="keywordflow">print</span> <span class="stringliteral">&quot;r counter is &quot;</span> + str(counter)   
<a name="l00371"></a>00371             <span class="keywordflow">for</span> orientingLayer <span class="keywordflow">in</span> oVLayers:
<a name="l00372"></a>00372                 info = QtCore.QFileInfo(orientingLayer)
<a name="l00373"></a>00373                 orientingLayerName = info.completeBaseName()
<a name="l00374"></a>00374                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;orientingLayerName is &quot;</span> + orientingLayerName
<a name="l00375"></a>00375                 <span class="keywordflow">if</span> legendLayerName == orientingLayerName:
<a name="l00376"></a>00376                     itemToMove = legend.topLevelItem(counter)
<a name="l00377"></a>00377                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;itemToMove is &quot;</span> + itemToMove.canvasLayer.layer().<a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">name</a>()                    
<a name="l00378"></a>00378                     position = numLegendLayers - (oVLayers.index(orientingLayer) + (rcount)) <span class="comment"># itemToMove is the base layer </span>
<a name="l00379"></a>00379                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;v position is &quot;</span> + str(position)
<a name="l00380"></a>00380                     <span class="keywordflow">print</span> type(position), position
<a name="l00381"></a>00381                     itemToMove.storeAppearanceSettings() <span class="comment"># Store settings </span>
<a name="l00382"></a>00382                     self.legend.takeTopLevelItem(counter)
<a name="l00383"></a>00383                     legend.insertTopLevelItem(0, itemToMove)
<a name="l00384"></a>00384                     vcount += 1
<a name="l00385"></a>00385                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;ending vcount is &quot;</span> + str(vcount)
<a name="l00386"></a>00386                     <span class="keywordflow">if</span> vcount == len(oVLayers):
<a name="l00387"></a>00387                         <span class="keywordflow">break</span>
<a name="l00388"></a>00388                     <span class="keywordflow">else</span>: <span class="keywordflow">continue</span>
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment"># Martin Dobias reading project properties</span>
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="stringliteral">&#39;&#39;&#39;The QgsProject class offers a similar interface to QSettings for</span>
<a name="l00393"></a>00393 <span class="stringliteral">access to properties. The example is mostly self-explanatory except</span>
<a name="l00394"></a>00394 <span class="stringliteral">for the &quot;[0]&quot; at the end of the readNumEntry lines. This function in</span>
<a name="l00395"></a>00395 <span class="stringliteral">python returns a tuple: first value is the number, second value is a</span>
<a name="l00396"></a>00396 <span class="stringliteral">boolean whether the conversion to number went fine - for simplicity we</span>
<a name="l00397"></a>00397 <span class="stringliteral">ignore that flag here.&#39;&#39;&#39;</span>
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="namespacesnippets.html#a5555df900f14a441917e93225287247f">00399</a> prj = QgsProject.instance()
<a name="l00400"></a><a class="code" href="namespacesnippets.html#a20261afebf9c59d5882b50d55bebc8d8">00400</a> r = prj.readNumEntry(<span class="stringliteral">&quot;Gui&quot;</span>, <span class="stringliteral">&quot;/SelectionColorRedPart&quot;</span>, 255)[0]
<a name="l00401"></a><a class="code" href="namespacesnippets.html#aff6b85a46888e28a406b097b13465b5a">00401</a> g = prj.readNumEntry(<span class="stringliteral">&quot;Gui&quot;</span>, <span class="stringliteral">&quot;/SelectionColorGreenPart&quot;</span>, 255)[0]
<a name="l00402"></a><a class="code" href="namespacesnippets.html#a1f749cc30396bd086e9bd89fa60e648b">00402</a> b = prj.readNumEntry(<span class="stringliteral">&quot;Gui&quot;</span>, <span class="stringliteral">&quot;/SelectionColorBluePart&quot;</span>, 0)[0]
<a name="l00403"></a><a class="code" href="namespacesnippets.html#ad404f3dd3b634227534f22ecc0151103">00403</a> a = prj.readNumEntry(<span class="stringliteral">&quot;Gui&quot;</span>, <span class="stringliteral">&quot;/SelectionColorAlphaPart&quot;</span>, 255)[0]
<a name="l00404"></a><a class="code" href="namespacesnippets.html#a5ef266e93de7717cae8d5da024198a05">00404</a> clr = QColor(r,g,b,a)
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 <span class="comment"># unneeded code because edit layers must be open if they exist in the scenario directory</span>
<a name="l00409"></a><a class="code" href="namespacesnippets.html#a575af53f3ca33880d21b1b45df8c93e4">00409</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a575af53f3ca33880d21b1b45df8c93e4">openEditLayer</a>(self):
<a name="l00410"></a>00410             <span class="comment"># edit file directory has same name as the scenario file (*.caps)</span>
<a name="l00411"></a>00411             info = self.mainwindow.info
<a name="l00412"></a>00412             directoryName = info.completeBaseName()
<a name="l00413"></a>00413             editFilePath = unicode(info.path() + <span class="stringliteral">&quot;/&quot;</span> + directoryName + <span class="stringliteral">&quot;/&quot;</span> + self.editLayer + <span class="stringliteral">&quot;.shp&quot;</span>)
<a name="l00414"></a>00414             
<a name="l00415"></a>00415             <span class="comment"># debugging</span>
<a name="l00416"></a>00416             <span class="keywordflow">print</span> <span class="stringliteral">&quot;the directory name is &quot;</span> + directoryName
<a name="l00417"></a>00417             <span class="keywordflow">print</span> <span class="stringliteral">&quot;the editFilePath is &quot;</span> + editFilePath
<a name="l00418"></a>00418             
<a name="l00419"></a>00419             <span class="comment"># if the file exists, open it (automatically goes to the top of the layer panel)</span>
<a name="l00420"></a>00420             editFile = QtCore.QFile(editFilePath)
<a name="l00421"></a>00421             <span class="keywordflow">if</span> editFile.exists():
<a name="l00422"></a>00422                 self.mainwindow.openVectorLayer(editFilePath)                 
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment"># unneeded orienting layer code</span>
<a name="l00427"></a><a class="code" href="namespacesnippets.html#a65666577ad5946ffe226ca51b55b7494">00427</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a65666577ad5946ffe226ca51b55b7494">openOrientingBaseLayers</a>(self, layers):
<a name="l00428"></a>00428         <span class="stringliteral">&#39;&#39;&#39; Open needed orienting layers and arrange &#39;&#39;&#39;</span>
<a name="l00429"></a>00429         legendLayers = layers
<a name="l00430"></a>00430         orientingVlayers = self.mainwindow.orientingVectorLayers
<a name="l00431"></a>00431         orientingRlayers = self.mainwindow.orientingRasterLayers
<a name="l00432"></a>00432         path = self.mainwindow.baseLayerPath
<a name="l00433"></a>00433         
<a name="l00434"></a>00434         <span class="comment"># Check for open and open if not</span>
<a name="l00435"></a>00435         <span class="keywordflow">for</span> legendLayer <span class="keywordflow">in</span> legendLayers:
<a name="l00436"></a>00436             legendLayerName = layer.layer().<a class="code" href="namespacesnippets.html#a89617d4941771266f3b7237d48604a28">name</a>()
<a name="l00437"></a>00437             <span class="keywordflow">for</span> orientingLayer <span class="keywordflow">in</span> orientingVlayers:
<a name="l00438"></a>00438                 info = QFileInfo(orientingLayer)
<a name="l00439"></a>00439                 orientingLayerName = info.completeBaseName()
<a name="l00440"></a>00440                 <span class="keywordflow">if</span> legendLayerName == orientingLayerName: 
<a name="l00441"></a>00441                     orientingVlayers.remove(orientingLayer)
<a name="l00442"></a>00442                     <span class="keywordflow">continue</span>
<a name="l00443"></a>00443             <span class="keywordflow">for</span> orientingLayer <span class="keywordflow">in</span> orientingRlayers:
<a name="l00444"></a>00444                 info = QFileInfo(orientingLayer)
<a name="l00445"></a>00445                 orientingLayerName = info.completeBaseName()
<a name="l00446"></a>00446                 <span class="keywordflow">if</span> legendLayerName == orientingLayerName: 
<a name="l00447"></a>00447                     orientingVlayers.remove(orientingLayer)
<a name="l00448"></a>00448                     <span class="keywordflow">continue</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="comment">#open a file with QFile</span>
<a name="l00454"></a><a class="code" href="namespacesnippets.html#a431a1c41795d0ccda76e5719ea5949e3">00454</a> editFile = QtCore.QFile(editFilePath)
<a name="l00455"></a>00455         
<a name="l00456"></a>00456 <span class="keywordflow">try</span>:
<a name="l00457"></a>00457     editFile.open(QtCore.QIODevice.ReadWrite)
<a name="l00458"></a>00458 <span class="keywordflow">except</span> (IOError, OSError), e:
<a name="l00459"></a><a class="code" href="namespacesnippets.html#abd2b09fb9b816a38329ab2abd83a6ee0">00459</a>     error = unicode(e)
<a name="l00460"></a>00460 <span class="keywordflow">if</span> error:
<a name="l00461"></a>00461     <span class="keywordflow">print</span> e
<a name="l00462"></a>00462     QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;File error:&quot;</span>, <span class="stringliteral">&quot;The scenario editing layer &quot;</span>\
<a name="l00463"></a>00463 + editLayer + <span class="stringliteral">&quot; failed to open. Could it have been damaged somehow?&quot;</span>)   
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="comment"># code for empty extents</span>
<a name="l00467"></a><a class="code" href="namespacesnippets.html#a85a7a32cfe7998e813144aafcb80a360">00467</a> extent = self.canvas.extent()
<a name="l00468"></a>00468 <span class="keywordflow">if</span> str(extent.xMinimum()) == <span class="stringliteral">&quot;-1.#IND&quot;</span>:                                                            
<a name="l00469"></a>00469     extent = QgsRectangle(32000, 780000, 330000, 965000) <span class="comment"># MA state extents   </span>
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="comment"># code used to save file name to open file dialog to last directory</span>
<a name="l00472"></a><a class="code" href="namespacesnippets.html#abeb9af9d56cadf8c7c0e2d9f811f8bda">00472</a> dir = os.path.dirname(self.rfilename) \
<a name="l00473"></a>00473                 <span class="keywordflow">if</span> self.rfilename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> <span class="stringliteral">&quot;./data/Base_layers&quot;</span>    
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="comment"># a slick way to make a list of 3 zeros </span>
<a name="l00476"></a><a class="code" href="namespacesnippets.html#a0b077f24b472292b84052a3bca946b8f">00476</a> groups = [0]*3
<a name="l00477"></a>00477 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(3):
<a name="l00478"></a>00478     groups[i] = self.getGroup(selected, header + i)
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="keywordflow">or</span> more <span class="stringliteral">&quot;Pythonically&quot;</span>:
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 groups = [self.getGroup(selected, header + i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(3)]
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="comment"># code for opening a console and finding and killing a process</span>
<a name="l00485"></a>00485 <span class="comment"># but only for UNIX!!</span>
<a name="l00486"></a>00486 <span class="comment">#!/usr/bin/env python</span>
<a name="l00487"></a>00487 <span class="keyword">import</span> os
<a name="l00488"></a>00488 <span class="keyword">import</span> signal
<a name="l00489"></a>00489  
<a name="l00490"></a>00490 <span class="comment"># Change this to your process name</span>
<a name="l00491"></a><a class="code" href="namespacesnippets.html#a6bdddc20c2551e2d118c912ec3e24c49">00491</a> processname = <span class="stringliteral">&#39;aterm&#39;</span>
<a name="l00492"></a>00492  
<a name="l00493"></a>00493 <span class="keywordflow">for</span> line <span class="keywordflow">in</span> os.popen(<span class="stringliteral">&quot;ps xa&quot;</span>):
<a name="l00494"></a><a class="code" href="namespacesnippets.html#a544009219c43c30b0497f305db64af8a">00494</a>     fields  = line.split()
<a name="l00495"></a><a class="code" href="namespacesnippets.html#a3976760ce0cf6cde6a6ca2376b58111c">00495</a>     pid     = fields[0]
<a name="l00496"></a><a class="code" href="namespacesnippets.html#aa457500b0cbc0a42a7f7155275a85d7d">00496</a>     process = fields[4]
<a name="l00497"></a>00497  
<a name="l00498"></a>00498     <span class="keywordflow">if</span> process.find(processname) &gt; 0:
<a name="l00499"></a>00499         <span class="comment"># Kill the Process. Change signal.SIGHUP to signal.SIGKILL if you like</span>
<a name="l00500"></a>00500         os.kill(int(pid), signal.SIGHUP)
<a name="l00501"></a>00501  
<a name="l00502"></a>00502         <span class="comment"># Do something else here</span>
<a name="l00503"></a>00503         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Doing something else here&quot;</span>
<a name="l00504"></a>00504  
<a name="l00505"></a>00505         <span class="comment"># Restart the process</span>
<a name="l00506"></a>00506         os.system(processname)
<a name="l00507"></a>00507  
<a name="l00508"></a>00508         <span class="comment"># Hop out of loop</span>
<a name="l00509"></a>00509         <span class="keywordflow">break</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="comment"># This is my last hope for finding out if QGIS is running:</span>
<a name="l00512"></a>00512 <span class="keyword">import</span> win32com.client
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="namespacesnippets.html#ad5de0257070d4ec8a7efb83005a4b763">00514</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#ad5de0257070d4ec8a7efb83005a4b763">find_process</a>(name):
<a name="l00515"></a>00515     objWMIService = win32com.client.Dispatch(<span class="stringliteral">&quot;WbemScripting.SWbemLocator&quot;</span>)
<a name="l00516"></a>00516     objSWbemServices = objWMIService.ConnectServer(<span class="stringliteral">&quot;.&quot;</span>, <span class="stringliteral">&quot;root\cimv2&quot;</span>)
<a name="l00517"></a>00517     colItems = objSWbemServices.ExecQuery(
<a name="l00518"></a>00518          <span class="stringliteral">&quot;Select * from Win32_Process where Caption = &#39;{0}&#39;&quot;</span>.format(name))
<a name="l00519"></a>00519     <span class="keywordflow">return</span> len(colItems)
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 <span class="keywordflow">print</span> <a class="code" href="namespacesnippets.html#ad5de0257070d4ec8a7efb83005a4b763">find_process</a>(<span class="stringliteral">&quot;SciTE.exe&quot;</span>)
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="stringliteral">&#39;&#39;&#39; clear the python interpreter &#39;&#39;&#39;</span>
<a name="l00526"></a>00526 <span class="keyword">import</span> os
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="namespacesnippets.html#a7ccca17cb3458998616fccfab17414e7">00528</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a7ccca17cb3458998616fccfab17414e7">clear</a>():
<a name="l00529"></a>00529     <span class="keywordflow">if</span> os.name == <span class="stringliteral">&#39;posix&#39;</span>:
<a name="l00530"></a>00530         os.system(<span class="stringliteral">&#39;clear&#39;</span>)
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="keywordflow">elif</span> os.name == (<span class="stringliteral">&#39;ce&#39;</span>, <span class="stringliteral">&#39;nt&#39;</span>, <span class="stringliteral">&#39;dos&#39;</span>):
<a name="l00533"></a>00533         os.system(<span class="stringliteral">&#39;cls&#39;</span>)
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <a class="code" href="namespacesnippets.html#a7ccca17cb3458998616fccfab17414e7">clear</a>()
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment"># using the lockfile module</span>
<a name="l00539"></a><a class="code" href="namespacesnippets.html#a8dc673b4145c94d654009d96467d67d1">00539</a> lock = LockFile(vfile)
<a name="l00540"></a>00540                 <span class="comment">#lock.acquire(0)</span>
<a name="l00541"></a>00541                 lock.break_lock()
<a name="l00542"></a>00542                 lock.acquire()
<a name="l00543"></a>00543             
<a name="l00544"></a>00544                 <span class="comment">#debugging</span>
<a name="l00545"></a>00545                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;type vfile = &quot;</span> + str(type(vfile))
<a name="l00546"></a>00546                 <span class="keywordflow">print</span> vfile
<a name="l00547"></a>00547                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;is locked? &quot;</span> + str(lock.is_locked())
<a name="l00548"></a>00548                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;is CAPS locking? &quot;</span> + str(lock.i_am_locking())
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="keywordflow">try</span>: 
<a name="l00551"></a>00551                     lock.acquire(timeout=0)
<a name="l00552"></a>00552                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;I locked &quot;</span>, lock.path 
<a name="l00553"></a>00553                 <span class="keywordflow">except</span> AlreadyLocked:
<a name="l00554"></a>00554                     QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;Failed to save:&quot;</span>, <span class="stringliteral">&quot;Please check if this \</span>
<a name="l00555"></a>00555 <span class="stringliteral">vector layer is open in another program.&quot;</span> + error)
<a name="l00556"></a>00556                     lock.break_lock()
<a name="l00557"></a>00557                 <span class="keywordflow">except</span> LockFailed:
<a name="l00558"></a>00558                     QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;Failed to save:&quot;</span>, <span class="stringliteral">&quot;Please check if this \</span>
<a name="l00559"></a>00559 <span class="stringliteral">vector layer is open in another program.&quot;</span> + error)
<a name="l00560"></a>00560                     lock.break_lock()   
<a name="l00561"></a>00561                     <span class="keywordflow">return</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="keywordflow">try</span>: 
<a name="l00564"></a>00564                     self.provider.deleteFeatures( pyList )
<a name="l00565"></a>00565                 <span class="keywordflow">except</span> (WindowsError, OSError, IOError):
<a name="l00566"></a>00566                     QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;Failed to save:&quot;</span>, <span class="stringliteral">&quot;Please check if this \</span>
<a name="l00567"></a>00567 <span class="stringliteral">vector layer is open in another program.&quot;</span> + error)
<a name="l00568"></a>00568                     <span class="keywordflow">return</span>
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="keywordflow">try</span>:
<a name="l00572"></a><a class="code" href="namespacesnippets.html#a8f557d30b3f5f3282239ed2cded44fd4">00572</a>                     f = open(vfile, <span class="stringliteral">&#39;rb&#39;</span>)
<a name="l00573"></a>00573                     f.close()
<a name="l00574"></a>00574                 <span class="keywordflow">except</span> IOError, e:
<a name="l00575"></a>00575                     error = unicode(e)
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="namespacesnippets.html#aed2eba977ade847895f3048abf176350">00577</a> lockFile = vfile + <span class="stringliteral">&quot;.lckchk&quot;</span>
<a name="l00578"></a>00578                 error = <span class="keywordtype">None</span>
<a name="l00579"></a>00579                 if(os.path.exists(lockFile)):
<a name="l00580"></a>00580                     os.remove(lockFile)
<a name="l00581"></a>00581                 <span class="keywordflow">try</span>:
<a name="l00582"></a>00582                     os.rename(vfile, lockFile)
<a name="l00583"></a>00583                     time.sleep(1)
<a name="l00584"></a>00584                     os.rename(lockFile, vfile)
<a name="l00585"></a>00585                 <span class="keywordflow">except</span> WindowsError, e:
<a name="l00586"></a>00586                     error = unicode(e)
<a name="l00587"></a>00587                     QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;Failed to save:&quot;</span>, <span class="stringliteral">&quot;Please check if this \</span>
<a name="l00588"></a>00588 <span class="stringliteral">vector layer is open in another program.&quot;</span> + error)
<a name="l00589"></a>00589                     <span class="keywordflow">return</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="keywordflow">try</span>: <span class="comment"># open file and read</span>
<a name="l00592"></a>00592             scenario.read(self.info)
<a name="l00593"></a>00593         <span class="keywordflow">except</span> (IOError, OSError), e:
<a name="l00594"></a>00594             error = unicode (e)
<a name="l00595"></a>00595         <span class="keywordflow">finally</span>:
<a name="l00596"></a>00596             <span class="keywordflow">if</span> scenarioFilePath:
<a name="l00597"></a><a class="code" href="namespacesnippets.html#aac946453e2fe7477a470cc580ad240ba">00597</a>                 scenario = <span class="keywordtype">None</span>
<a name="l00598"></a>00598             <span class="keywordflow">if</span> error:
<a name="l00599"></a>00599                 QtGui.QMessageBox.warning(self, <span class="stringliteral">&quot;File Error&quot;</span>, error)
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="namespacesnippets.html#ac0387a0f88fe9c8ed59fe96401b10549">00601</a>     <span class="keyword">def </span><a class="code" href="namespacesnippets.html#ac0387a0f88fe9c8ed59fe96401b10549">updateStatusBar</a>(self):
<a name="l00602"></a>00602         capture_string = QtCore.QString(self.scenarioFileName)
<a name="l00603"></a>00603         self.statusBar.showMessage(capture_string, 8000)
<a name="l00604"></a>00604 <span class="stringliteral">&#39;&#39;&#39; save as dialog code &#39;&#39;&#39;</span>
<a name="l00605"></a><a class="code" href="namespacesnippets.html#a9f015c7398aa953327579a3b8f54e179">00605</a> qd = QtGui.QFileDialog()
<a name="l00606"></a><a class="code" href="namespacesnippets.html#abc67aa0abd01c70f60a035ec2e7aa45a">00606</a>         filter_str = QtCore.QString(<span class="stringliteral">&quot;CAPS Scenario*.cap *.cap)\nAll Files(*)&quot;</span>)
<a name="l00607"></a>00607         <span class="comment"># get the path to the directory for the saved file Python</span>
<a name="l00608"></a>00608         dir = os.path.dirname(<span class="stringliteral">&quot;./data/Scenarios/&quot;</span>) \
<a name="l00609"></a>00609         <span class="comment"># change the QString to unicode so that Python can slice it for the directory name </span>
<a name="l00610"></a><a class="code" href="namespacesnippets.html#a53c1accdae8811191bb6127e79a1bb3e">00610</a>         scenarioFileName = unicode(qd.getSaveFileName(self, QtCore.QString(<span class="stringliteral">&quot;New Scenario&quot;</span>),
<a name="l00611"></a>00611                                             dir, filter_str))
<a name="l00612"></a>00612         <span class="comment"># Check for cancel</span>
<a name="l00613"></a>00613         <span class="keywordflow">if</span> len(scenarioFileName) == 0:
<a name="l00614"></a>00614             <span class="keywordflow">return</span>
<a name="l00615"></a>00615         
<a name="l00616"></a>00616         <span class="comment"># remember the opened filename (Python unicode)</span>
<a name="l00617"></a>00617         self.scenarioFileName = scenarioFileName
<a name="l00618"></a>00618         <span class="comment"># add filename to statusbar with 8 sec. timeout</span>
<a name="l00619"></a>00619         capture_string = QtCore.QString(scenarioFileName)
<a name="l00620"></a>00620         self.statusBar.showMessage(capture_string, 8000)
<a name="l00621"></a>00621         self.info = QtCore.QFileInfo(QtCore.QString(scenarioFileName))
<a name="l00622"></a>00622         <span class="comment"># write the project information to a file using QgsProject</span>
<a name="l00623"></a>00623         self.scenario = QgsProject.instance()
<a name="l00624"></a>00624         self.scenario.write(self.info)
<a name="l00625"></a>00625         <span class="comment"># create an associated directory to store the scenario&#39;s editing files</span>
<a name="l00626"></a><a class="code" href="namespacesnippets.html#affc9f2b9828461992ef36c88f1343fa9">00626</a>         directoryName = self.info.completeBaseName()
<a name="l00627"></a>00627         QtCore.QDir().mkdir(<span class="stringliteral">&quot;./data/Scenarios/&quot;</span> + directoryName)
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 identify tool
<a name="l00630"></a>00630 res, ident = rlayer.identify(QgsPoint(15.30,40.98))
<a name="l00631"></a>00631 <span class="keywordflow">for</span> (k,v) <span class="keywordflow">in</span> ident.iteritems():
<a name="l00632"></a>00632   <span class="keywordflow">print</span> str(k),<span class="stringliteral">&quot;:&quot;</span>,str(v)
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 extent = self.activeVLayer.extent()
<a name="l00637"></a>00637 extent.scale(1.05)
<a name="l00638"></a>00638 self.canvas.setExtent(extent)
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 &gt;&gt;&gt; x = [1, 2, 3, 4, 5, 6, 7, 8]
<a name="l00642"></a>00642 &gt;&gt;&gt; y = [4, 7, 9]
<a name="l00643"></a>00643 &gt;&gt;&gt; list(set(x) - set(y))
<a name="l00644"></a>00644 [1, 2, 3, 5, 6, 8]
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 self.chkEditMode(callingAction)
<a name="l00648"></a>00648 <span class="keywordflow">if</span> self.appStateChanged(<span class="stringliteral">&quot;startingEditing&quot;</span>) == <span class="stringliteral">&quot;Cancel&quot;</span>:.destroy(<span class="keyword">True</span>, <span class="keyword">True</span>)
<a name="l00649"></a>00649 
<a name="l00650"></a>00650         
<a name="l00651"></a>00651  <span class="comment"># this block of code will only handle toggle type tools </span>
<a name="l00652"></a>00652         <span class="comment"># that are part of the &quot;toolGroup.&quot; The &quot;editingStopped&quot;</span>
<a name="l00653"></a>00653         <span class="comment"># callingAction gets handled below.</span>
<a name="l00654"></a>00654         <span class="comment">#(select features, add points, add lines, add polygons)</span>
<a name="l00655"></a>00655         <span class="stringliteral">&#39;&#39;&#39;toolAction = None</span>
<a name="l00656"></a>00656 <span class="stringliteral">        if not self.toolGroup.checkedAction() == None:</span>
<a name="l00657"></a>00657 <span class="stringliteral">            print &quot;setting toolGroup.checkedAction name&quot;</span>
<a name="l00658"></a>00658 <span class="stringliteral">            toolAction = self.toolGroup.checkedAction().objectName()</span>
<a name="l00659"></a>00659 <span class="stringliteral">        print &quot;toolAction = &quot; + str(toolAction)&#39;&#39;&#39;</span>
<a name="l00660"></a>00660         
<a name="l00661"></a>00661         <span class="keywordflow">if</span> toolAction == <span class="stringliteral">&quot;mpActionSelectFeatures&quot;</span>:
<a name="l00662"></a>00662             <span class="comment"># The line of code below is for the bizarre situation where all tool group actions been</span>
<a name="l00663"></a>00663             <span class="comment"># set to unchecked when a raster was loaded but the &quot;self.toolGroup.checked()&quot; </span>
<a name="l00664"></a>00664             <span class="comment"># Qt method still has the value &quot;mpActionSelectFeatures&quot; !!! really bizarre!</span>
<a name="l00665"></a>00665             <span class="comment"># If we are loading a raster or we have and activeRLayer or the VLayer = None</span>
<a name="l00666"></a>00666             <span class="comment"># then chkSelectState has already been called by either </span>
<a name="l00667"></a>00667             <span class="comment"># removeCurrentLayer, legendMousePress, addVector or addRaster.</span>
<a name="l00668"></a>00668             <span class="comment"># So, no need to call chkSelectState again just return.</span>
<a name="l00669"></a>00669             <span class="keywordflow">if</span> self.layerType == 1 <span class="keywordflow">or</span> self.activeRLayer <span class="keywordflow">or</span> self.activeVLayer == <span class="keywordtype">None</span>:
<a name="l00670"></a>00670                 <span class="keywordflow">return</span>
<a name="l00671"></a>00671             <span class="comment"># So, we must be working with a vector layer</span>
<a name="l00672"></a>00672             <span class="keywordflow">print</span> <span class="stringliteral">&quot;length of selected features &quot;</span> + str(len(self.activeVLayer.selectedFeatures()))
<a name="l00673"></a>00673             <span class="comment"># if there are no selected features, no need to prompt the user.</span>
<a name="l00674"></a>00674             <span class="keywordflow">if</span> len(self.activeVLayer.selectedFeatures()) == 0:
<a name="l00675"></a>00675                 <span class="keywordflow">return</span>
<a name="l00676"></a>00676             <span class="keywordflow">elif</span> self.chkSelectState(callingAction) == <span class="stringliteral">&quot;Cancel&quot;</span>:
<a name="l00677"></a>00677                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cancel&quot;</span>
<a name="l00678"></a>00678         <span class="keywordflow">elif</span> toolAction == <span class="stringliteral">&quot;mpActionAddPoints&quot;</span>:
<a name="l00679"></a>00679             <span class="comment"># this is for the bizarre situation where the tool button has been</span>
<a name="l00680"></a>00680             <span class="comment"># set to unchecked when the raster was loaded but &quot;self.toolGroup.checked </span>
<a name="l00681"></a>00681             <span class="comment"># action still has the value &quot;mpActionAddPoints&quot; !!! really bizarre!</span>
<a name="l00682"></a>00682             <span class="keywordflow">if</span> self.layerType == 1 <span class="keywordflow">or</span> self.activeRLayer <span class="keywordflow">or</span> self.activeVLayer == <span class="keywordtype">None</span>:
<a name="l00683"></a>00683                             <span class="keywordflow">elif</span> self.editDirty == <span class="keyword">False</span>:
<a name="l00684"></a>00684                 <span class="keywordflow">return</span>
<a name="l00685"></a>00685             <span class="keywordflow">elif</span> self.toolAddPoints.numberFeaturesAdded() == 0:
<a name="l00686"></a>00686                 <span class="keywordflow">return</span>
<a name="l00687"></a>00687             <span class="keywordflow">elif</span> self.chkAddPointsState(callingAction) == <span class="stringliteral">&quot;Cancel&quot;</span>:
<a name="l00688"></a>00688                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cancel&quot;</span>
<a name="l00689"></a>00689         
<a name="l00690"></a>00690         
<a name="l00691"></a>00691       
<a name="l00692"></a>00692         
<a name="l00693"></a>00693         
<a name="l00694"></a>00694         self.legend.blockSignals(<span class="keyword">True</span>)
<a name="l00695"></a>00695         provider.reloadData()
<a name="l00696"></a>00696         self.activeVLayer.removeSelection(<span class="keyword">False</span>)
<a name="l00697"></a>00697         <span class="stringliteral">&#39;&#39;&#39; Add the new feature and display &#39;&#39;&#39;</span>
<a name="l00698"></a>00698         provider.reloadData
<a name="l00699"></a><a class="code" href="namespacesnippets.html#a14e809d5f8118c0bc99a1d9d28f3d8b7">00699</a>         provider = self.vlayer.dataProvider()
<a name="l00700"></a><a class="code" href="namespacesnippets.html#a6fe2c8ad1b8d1cda6e203a6a7e78b12c">00700</a>         feat = QgsFeature()
<a name="l00701"></a>00701         feat.setGeometry(QgsGeometry.fromPoint(self.qgsPoint))
<a name="l00702"></a>00702         feat.setAttributeMap(attributes)
<a name="l00703"></a>00703         <span class="comment"># the 0 and 1 represent the field numbers</span>
<a name="l00704"></a>00704         feat.setAttributeMap({0 : QtCore.QVariant(5), 1 : QtCore.QVariant(<span class="stringliteral">&quot;test&quot;</span>)})
<a name="l00705"></a>00705         this actually writes the added point to disk
<a name="l00706"></a>00706         provider.addFeatures([ feat ])
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="stringliteral">&#39;&#39;&#39;old restoreLegendState code and my first attempts at model view&#39;&#39;&#39;</span>
<a name="l00709"></a>00709 <span class="keywordflow">print</span> type(self.legend.selectionModel())
<a name="l00710"></a>00710         self.oldSelection <span class="keywordflow">is</span> a QModelIndex 
<a name="l00711"></a>00711         legend.selectionModel() returns a QItemSelectionModel <span class="keyword">class</span><span class="stringliteral">&#39;&#39;&#39;</span>
<a name="l00712"></a>00712 <span class="stringliteral">        &#39;&#39;&#39;</span>indexes = self.legend.selectionModel().selectedIndexes()
<a name="l00713"></a>00713         <span class="keywordflow">for</span> ind <span class="keywordflow">in</span> indexes:
<a name="l00714"></a><a class="code" href="namespacesnippets.html#a7585affe178069d5c7579adddc75b39c">00714</a>         text = QtCore.QString(<span class="stringliteral">&quot;(%1,%2)&quot;</span>).arg(ind.row()).arg(ind.column())
<a name="l00715"></a>00715         <span class="keywordflow">print</span> QtCore.QString(<span class="stringliteral">&quot;(%1,%2)&quot;</span>).arg(ind.row()).arg(ind.column())
<a name="l00716"></a>00716         self.legend.model().setData(ind, text)
<a name="l00717"></a><a class="code" href="namespacesnippets.html#a30532c9438ef246a1272853265062430">00717</a>         indexMaker = QtGui.QStandardItemModel.index()
<a name="l00718"></a><a class="code" href="namespacesnippets.html#a3254cb456030f9dc434db32c2b47c704">00718</a>         topLeft = indexMaker.createIndex(0,0)
<a name="l00719"></a><a class="code" href="namespacesnippets.html#a5e51e9cf7b15b9120423ee499c99eaa9">00719</a>         selection = QtGui.QItemSelection(topLeft, oldSelection)
<a name="l00720"></a>00720         self.legend.selectionModel().select(selection, QtGui.QItemSelectionModel.Select)
<a name="l00721"></a>00721         self.legend.repaint()
<a name="l00722"></a>00722         self.legend.selectionModel().clearSelection()
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="stringliteral">&#39;&#39;&#39;Check what type of symbol renderer the vector layer is using&#39;&#39;&#39;</span>
<a name="l00725"></a>00725 <span class="keywordflow">if</span> self.vlayer.isUsingRendererV2():
<a name="l00726"></a>00726     <span class="comment"># new symbology - subclass of QgsFeatureRendererV2 class</span>
<a name="l00727"></a>00727     <span class="comment">#rendererV2 = self.vlayer.rendererV2()</span>
<a name="l00728"></a>00728     <span class="keywordflow">print</span> <span class="stringliteral">&quot;V2&quot;</span>
<a name="l00729"></a>00729 <span class="keywordflow">else</span>:
<a name="l00730"></a>00730     <span class="comment"># old symbology - subclass of QgsRenderer class</span>
<a name="l00731"></a>00731     <span class="comment">#self.vlayer = self.vlayer.renderer()</span>
<a name="l00732"></a>00732     <span class="keywordflow">print</span> <span class="stringliteral">&quot;V1&quot;</span>
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="stringliteral">&#39;&#39;&#39;some work on writing shapfiles to disk&#39;&#39;&#39;</span>
<a name="l00735"></a>00735 <span class="keywordflow">print</span> <span class="stringliteral">&quot; Write shapefile to disk &quot;</span>
<a name="l00736"></a><a class="code" href="namespacesnippets.html#a0660e6d17df20a1af43d5800961fbcbd">00736</a> crs = self.provider.crs()
<a name="l00737"></a>00737 fields = self.provider.fields()
<a name="l00738"></a><a class="code" href="namespacesnippets.html#a25cad1b91358193d82ef05a29de958cf">00738</a> writer = QgsVectorFileWriter(<span class="stringliteral">&quot;test_points.shp&quot;</span>, <span class="stringliteral">&quot;UTF-8&quot;</span>, fields, QGis.WKBPoint, crs)
<a name="l00739"></a>00739 <span class="keywordflow">if</span> writer.hasError() != QgsVectorFileWriter.NoError:
<a name="l00740"></a>00740     <span class="keywordflow">print</span> <span class="stringliteral">&quot;Error when creating shapefile: &quot;</span>, writer.hasError()
<a name="l00741"></a>00741 <span class="keywordflow">print</span> writer.hasError()
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 <span class="stringliteral">&#39;&#39;&#39;example of QgsVertexMarker&#39;&#39;&#39;</span>
<a name="l00744"></a><a class="code" href="namespacesnippets.html#a2dbef8fdde2a0f5747ee1d809798d2f1">00744</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#a0a834ce9077c39b3ef65b02a790fb688">markPoint</a>(self, point):
<a name="l00745"></a>00745         <span class="comment"># display the clicked point on the screen</span>
<a name="l00746"></a>00746         marker = QgsVertexMarker(self.canvas)
<a name="l00747"></a>00747         transform = self.canvas.getCoordinateTransform()
<a name="l00748"></a>00748         self.qgspoint = transform.toMapCoordinates(point.x(), point.y())
<a name="l00749"></a>00749         marker.setPenWidth(2)
<a name="l00750"></a>00750         marker.setCenter(self.qgspoint)
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 <span class="stringliteral">&#39;&#39;&#39;example of intersects&#39;&#39;&#39;</span>
<a name="l00753"></a><a class="code" href="namespacesnippets.html#ab85df218017e82d5aeb3002f233ae10c">00753</a> <span class="keyword">def </span><a class="code" href="namespacesnippets.html#ab85df218017e82d5aeb3002f233ae10c">__getIdFeaturesIntersect</a>(self, rect, lyr):
<a name="l00754"></a>00754     prov = lyr.dataProvider()
<a name="l00755"></a><a class="code" href="namespacesnippets.html#a779eba20b4bc15f239403e7a1d9b30b3">00755</a>     allAttrs = prov.attributeIndexes()
<a name="l00756"></a>00756     prov.select(allAttrs, core.QgsRectangle())
<a name="l00757"></a>00757     idInSpatialIndex = self.__createIndex(prov).intersects(rect)
<a name="l00758"></a>00758     prov.rewind()
<a name="l00759"></a>00759     ids = []
<a name="l00760"></a>00760     feat = core.QgsFeature()
<a name="l00761"></a>00761     <span class="keywordflow">for</span> id <span class="keywordflow">in</span> idInSpatialIndex:
<a name="l00762"></a>00762       prov.featureAtId(int(id), feat, <span class="keyword">True</span>)
<a name="l00763"></a>00763       <span class="keywordflow">if</span> feat.geometry().intersects(rect):
<a name="l00764"></a>00764         ids.append(int(id)) 
<a name="l00765"></a>00765     <span class="keywordflow">return</span> ids
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="stringliteral">&#39;&#39;&#39; cursor &#39;&#39;&#39;</span>
<a name="l00768"></a>00768 self.canvas.setCursor(cursor)
<a name="l00769"></a>00769 self.canvas.unsetCursor(cursor)
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="stringliteral">&#39;&#39;&#39;make circle ??&#39;&#39;&#39;</span>
<a name="l00772"></a>00772 self.center = self.toMapCoordinates(e.pos())
<a name="l00773"></a>00773 self.rb=QgsRubberBand(self.canvas,<span class="keyword">True</span>)
<a name="l00774"></a>00774 rbcircle(self.rb,self.center,self.center,40)
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="stringliteral">&#39;&#39;&#39;both of these worked in selectfeatures.py</span>
<a name="l00778"></a>00778 <span class="stringliteral"> when mainwindow had a variable self.test&#39;&#39;&#39;</span>
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keywordflow">print</span>  parent.test
<a name="l00781"></a>00781 <span class="keywordflow">print</span>  self.mainwindow.test
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="stringliteral">&#39;&#39;&#39;Add Path to system path&#39;&#39;&#39;</span> 
<a name="l00784"></a>00784 sys.path.insert(0, <span class="stringliteral">&quot;path&quot;</span>)
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="stringliteral">&#39;&#39;&#39;Return prefixPath&#39;&#39;&#39;</span>
<a name="l00787"></a>00787 QgsApplication.prefixPath()
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="stringliteral">&#39;&#39;&#39;Exit QGis&#39;&#39;&#39;</span>
<a name="l00790"></a>00790 QgsApplication.exitQgis()
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="stringliteral">&#39;&#39;&#39;get the extent as QgsRectangle&#39;&#39;&#39;</span>
<a name="l00793"></a><a class="code" href="namespacesnippets.html#aa4b290816b0da3d2f040225754e02f7e">00793</a> layer = <span class="stringliteral">&quot;some layer&quot;</span>
<a name="l00794"></a><a class="code" href="namespacesnippets.html#a62a300d144c3a523908ec9278ee14cb0">00794</a> layerExtent = layer.extent()
<a name="l00795"></a>00795 <span class="comment"># extends a little bit the layer extent to be sure to get all features ( as point in the frontier)</span>
<a name="l00796"></a>00796 layerExtent.scale(1.1, layerExtent.center())
<a name="l00797"></a>00797 <span class="comment"># select the features in this rectangle ie all features</span>
<a name="l00798"></a>00798 layer.select(layerExtent, <span class="keyword">True</span>)
<a name="l00799"></a>00799         
<a name="l00800"></a>00800 <span class="stringliteral">&#39;&#39;&#39;generic message box&#39;&#39;&#39;</span>
<a name="l00801"></a>00801 self.mb = QtGui.QMessageBox()
<a name="l00802"></a><a class="code" href="namespacesnippets.html#aae009abbf6fa000f6fa206d21e0bee30">00802</a> title = QtCore.QString(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00803"></a>00803 self.mb.setWindowTitle(title)
<a name="l00804"></a><a class="code" href="namespacesnippets.html#a16366b2638c545f7f7d42c17df573b5e">00804</a> txt = QtCore.QString(<span class="stringliteral">&quot;You can only select features from a vector layer.\</span>
<a name="l00805"></a>00805 <span class="stringliteral">Please select a vector layer in the layer panel and click &#39;Select Features&#39; again.&quot;</span>)
<a name="l00806"></a>00806 self.mb.setText(txt)
<a name="l00807"></a>00807 self.mb.exec_()
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 12 2012 10:42:22 for Caps Scenario Builder by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
